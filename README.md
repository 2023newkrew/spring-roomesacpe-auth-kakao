## 1단계

### 기능 요구사항
- 토큰 발급하는 API 생성
- 내 정보 조회하기
  - 토큰을 이용하여 본인 정보 응답하기

### 기능 구현 목록
- [x] 인증 담당하는 컨트롤러 생성
- [x] 인증 및 토큰 발급 담당하는 서비스 생성
  - [x] 예외처리 필요
    - [x] 멤버에 없는 경우
    - [x] 인증이 안되었을 때
- [x] 토큰을 인증하고 유저 정보를 가져오는 ArgumentResolver 생성
- [x] WebMvcConfigure 에 resolver 등록
- [x] 토큰을 이용하여 본인 정보 조회
  - [x] 예외처리 - 토큰이 없이 요청하는 경우


## 2단계

### 기능 요구사항
- 예약하기, 예약취소 개선
- 아래의 API 설계에 맞춰 API 스펙을 변경한다.
  - 비로그인 사용자는 예약이 불가능하다.
  - 자신의 예약이 아닌 경우 예약 취소가 불가능하다.

### 기능 구현 목록
- [x] 예약 생성시 토큰 확인하여 유효한 경우에만 예약 가능하도록
- [x] 예약 삭제시 토큰 확인하여 유효한 경우에만 예약 취소하도록
  - [x] 예외처리
    - [x] 인증이 되지 않은 경우
    - [x] 스케줄이나 예약이 존재하지 않는 경우
    - [x] 예약의 주인과 다른 유저가 삭제요청 하는 경우


## 리팩토링

### 리팩토링 목록
- [x] 패스워드 단방향 암호화 적용 - dbms 자체 기능 활용. 인증시에 활용
  - [x] 비밀번호 스키마 변경 (varbinary 512)
  - [x] sha2(password, 512) 함수 적용 - h2 에서는 hash('sha3-512', password)
  - [x] 인증시 id 와 암호화된 pw 로 조회하여 확인
- [x] token validation 후 예외처리 추가
- [x] member 생성시 중복 판단 기준 생각해보기
  - [x] username 과 phone 에 unique 적용하기
  - [x] unique 조건에 의해 exception 발생시 예외처리하기
- [x] reservation 에서 member 를 식별하는 필드를 memberId 로 변경할지 고민해보기
  - 이렇게 하면 멤버의 식별에 있어서도 유일하게 식별 가능하고, 확인 로직 등도 단순해짐
  - [x] reservation 스키마 수정 - name 대신 member_id 사용하도록
  - [x] reservation 도메인 및 관련 로직 수정

## 3단계

### 기능 요구사항
- 관리자 역할을 추가한다.
  - 일반 멤버와 관리자 멤버를 구분한다.
- 관리자 기능을 보호한다.
  - 관리자 관련 기능 API 는 /admin 붙이고 interceptor 로 검증한다.
  - 관리자 관련 기능 API 는 authorization 헤더를 이용하여 인증과 인가를 진행한다.
- 그 외 관리자 API 는 자유롭게 설계하고 적용한다.

### 기능 구현 목록
- [x] 테이블 수정
  - [x] Member 테이블에 role 필드 추가?
    - 관리자가 일반 유저 대비 극소수인데 일반 유저 권한까지 저장하는 필드를 만들면 비효율적이진 않을까?
    - 현 애플리케이션은 굉장히 간단하고, 관리자와 일반 유저의 분리만 필요. 그리고 애초에 관리자를 등록할 수 있는 api 를 제공하지 않음
    - 따라서 가장 단순한 방법으로 role 필드 추가,,
      - [x] 변경에 따른 예외처리
  - [ ] ~~Admin 테이블 생성하여 관리자만 등록?~~
    - member id 밖에 등록할게 없는데 굳이 테이블을 분리?
    - 확장성을 고려하면 권한 매핑하는 테이블을 만드는 것도 방법
      - 현재 애플리케이션은 권한을 선택할 수도 없고, 애초에 애플리케이션 실행시 하드로 관리자를 등록하는데 그렇게까지 할 필요가?
- [x] 애플리케이션 부팅시 관리자 등록
- [ ] 관리자 검증 interceptor 생성 및 등록
  - [ ] authorization 헤더 검증
    - [ ] ~~payload 에서 id 추출, id 로 db 접근해 권한 알아낸다?~~
      - 프레젠테이션 레이어에 존재하는 인터셉터에서 db 에 접근하는게 좋은 방향일까?
      - 매번 관리자 기능에 접근할 때마다 db 에 접근해서 확인하게 되면 성능저하 있지 않을까?
        - db 매번 접근하는 것은 overhead 의 문제가 있는데, 캐싱을 하면 해결됨.
        - 토큰 payload 에 담는 것보다는 db 조회해서 확인하는게 확실하긴 함 - 권한이 바뀔 수 있다는 전제
        - 미션에서는 권한이 바뀔일이 없기도 하고, 작은 앱이라 캐싱하기도 애매함.
    - [ ] payload 에서 바로 권한 확인?
      - [ ] 토큰 생성시 id 와 권한을 담는다?
        - id 를 통해 권한을 알 수 있는데 굳이?
          - db 를 확인하기엔 오버헤드가 있고, 캐싱을 하기에는 작은 프로그램인듯
        - payload 에 권한같은 정보를 담는 것이 괜찮을까?
          - payload 에 민감한 정보를 담아서는 안되기도 하고 권한이 바뀌었는데 적용안될 우려가 있긴 함
          - 미션에서는 권한 바뀔일 없음. 
        - payload 를 변조해서 보내는 경우는 없을까?
          - jwt 자체가 변조 방지가 목적이어서 변조될일은 없는듯 함
- [ ] 관리자 검증 interceptor 적용 - 관리자 전용 페이지에 /admin/ 추가

